<div *ngIf="matchReady">
  <mat-sidenav-container [hasBackdrop]="false">
    <mat-sidenav
      #drawer
      [mode]="'over'"
      [opened]="true"
      position="end"
      class="drawer"
    >
      <button mat-icon-button class="mr-2" (click)="drawer.toggle()">
        <mat-icon svgIcon="arrow-right"></mat-icon>
      </button>

      <button
        mat-raised-button
        [disabled]="!dirty"
        class="mr-2"
        (click)="save()"
      >
        GO!
      </button>

      <div class="mt-2 right-panel-scroll">
        <mat-accordion>
          <mat-expansion-panel>
            <mat-expansion-panel-header> Help </mat-expansion-panel-header>
            <app-mark-down [fileName]="'help/code_editor_help'"></app-mark-down>
          </mat-expansion-panel>

          <mat-expansion-panel [expanded]="true">
            <mat-expansion-panel-header> On Repeat </mat-expansion-panel-header>
            <app-code-editor eventId="repeat"
              [code]="codes.onRepeat"
              (onChange)="updateCode('onRepeat', $event)"
            >
            </app-code-editor>
          </mat-expansion-panel>

          <mat-expansion-panel>
            <mat-expansion-panel-header> On Start </mat-expansion-panel-header>
            <app-code-editor eventId="start"
              [code]="codes.onStart"
              (onChange)="updateCode('onStart', $event)"
            >
            </app-code-editor>
          </mat-expansion-panel>

          <mat-expansion-panel>
            <mat-expansion-panel-header>
              On Hit Wall
            </mat-expansion-panel-header>
            <app-code-editor eventId="hitWall"
              [code]="codes.onHitWall"
              (onChange)="updateCode('onHitWall', $event)"
            >
            </app-code-editor>
          </mat-expansion-panel>

          <mat-expansion-panel>
            <mat-expansion-panel-header> On Found </mat-expansion-panel-header>
            <app-code-editor eventId="found"
              [config]="useOther"
              [code]="codes.onFound"
              (onChange)="updateCode('onFound', $event)"
            >
            </app-code-editor>
          </mat-expansion-panel>

          <mat-expansion-panel>
            <mat-expansion-panel-header>
              On Got Damage
            </mat-expansion-panel-header>
            <app-code-editor eventId="gotDamage"
              [config]="useOther"
              [code]="codes.onGotDamage"
              (onChange)="updateCode('onGotDamage', $event)"
            >
            </app-code-editor>
          </mat-expansion-panel>

          <mat-expansion-panel>
            <mat-expansion-panel-header>
              On Hit Other
            </mat-expansion-panel-header>
            <app-code-editor eventId="hitOther"
              [config]="useOther"
              [code]="codes.onHitOther"
              (onChange)="updateCode('onHitOther', $event)"
            >
            </app-code-editor>
          </mat-expansion-panel>

          <mat-expansion-panel>
            <mat-expansion-panel-header>
              Code messages
            </mat-expansion-panel-header>
            <app-message
              class="message-panel"
              [messageSubject]="messageSubject"
            ></app-message>
          </mat-expansion-panel>
        </mat-accordion>
      </div>
    </mat-sidenav>

    <section>
      <button mat-icon-button class="toogle" (click)="drawer.toggle()">
        <mat-icon svgIcon="arrow-left"></mat-icon>
      </button>

      <div *ngIf="gameDefinition">
        <app-watch-match
          [gameDefinition]="gameDefinition"
          [luchador]="luchador"
          [matchID]="matchID"
          [inCameraChangeSubject]="cameraChangeSubject"
          (matchFinished)="endMatch()"
          (matchStateSubject)="updateState($event)"
          (messageSubject)="updateMessage($event)"
        >
        </app-watch-match>
      </div>
    </section>
  </mat-sidenav-container>

  <div class="navigation no-gutters">
    <div class="row">
      <div class="col-2">
        <button mat-icon-button class="navigation-button mr-1" (click)="goHome()">
          <mat-icon svgIcon="menu"></mat-icon>
        </button>
        <br />
        <button
          mat-icon-button
          class="navigation-button mt-2"
          (click)="changeCamera()"
        >
          <mat-icon svgIcon="camera-switch"></mat-icon>
        </button>
      </div>
      <div class="col ml-3" >
        <div class="mb-1">
          <app-clock class="clock" [matchStateSubject]="matchStateSubject"></app-clock>
        </div>
        <div *ngIf="displayScore">
          <app-score  [scores]="scores"></app-score>
        </div>
      </div>
    </div>
  </div>

</div>

<div class="p-3 matchover-alert" *ngIf="matchOver">
  <mat-card>
    <mat-card-title
      ><h1>{{ matchOverTitle }}</h1></mat-card-title
    >
    <mat-card-content>
      <div class="score-in-alert">
        <app-score *ngIf="displayScore" [scores]="scores"></app-score>
      </div>
    </mat-card-content>
    <mat-card-actions>
      <button mat-raised-button class="mb-2" (click)="goBack()">
        <span>BACK</span>
      </button>
    </mat-card-actions>
  </mat-card>
</div>

<div class="p-3 matchover-preparing" *ngIf="matchPreparing">
  <mat-card>
    <mat-card-title><h1>Getting ready</h1></mat-card-title>
    <mat-card-content>
      <div>{{ notReadyMessage }}</div>
    </mat-card-content>
    <mat-card-actions>
      <button mat-raised-button class="mb-2" (click)="goBack()">
        <span>BACK</span>
      </button>
    </mat-card-actions>
  </mat-card>
</div>

<div class="p-3 matchover-link-invalid" *ngIf="matchLinkInvalid">
  <mat-card>
    <mat-card-title><h1>This link is not valid anymore, this match is over</h1></mat-card-title>
    <mat-card-content></mat-card-content>
    <mat-card-actions>
      <button mat-raised-button class="mb-2" (click)="goBack()">
        <span>BACK</span>
      </button>
    </mat-card-actions>
  </mat-card>
</div>
